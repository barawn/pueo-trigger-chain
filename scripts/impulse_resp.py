import matplotlib.pyplot as plt
import numpy as np
# 1) Impulse response
data = [
    5.04503902e+01, -1.12545987e+02, -1.04093176e+02, 1.94431729e+02,
    2.29691990e+02, -2.83741903e+02, -5.26255092e+02, 1.77403461e+02,
    8.97102066e+02, 3.60130942e+02, -8.44514638e+02, -1.00381141e+03,
    9.21518314e+01, 9.50299985e+02, 6.74887883e+02, -8.00379710e+01,
    -4.73143089e+02, -4.61061194e+02, -2.85860047e+02, 2.65032434e+00,
    3.11073211e+02, 4.18987060e+02, 2.61820459e+02, -1.16049466e+01,
    -2.36069577e+02, -3.20863231e+02, -2.44201811e+02, -6.15146451e+01,
    1.27301224e+02, 2.37776449e+02, 2.32307266e+02, 1.27635084e+02,
    -2.30518423e+01, -1.54552781e+02, -2.11187258e+02, -1.73240462e+02,
    -6.56401685e+01, 5.91043049e+01, 1.49621435e+02, 1.73735929e+02,
    1.24941069e+02, 2.72209585e+01, -7.54590794e+01, -1.41977511e+02,
    -1.49878088e+02, -9.84649492e+01, -9.51643521e+00, 7.71902138e+01,
    1.25304942e+02, 1.21673944e+02, 7.41597684e+01, 8.05993100e-02,
    -7.50919376e+01, -1.19732921e+02, -1.13411848e+02, -6.18889894e+01,
    8.81257117e+00, 6.99605718e+01, 1.00710037e+02, 9.15102387e+01,
    4.72735275e+01, -1.31304204e+01, -6.51094601e+01, -8.98461426e+01,
    -8.07868033e+01, -4.37925148e+01, 6.40473450e+00, 5.15857183e+01,
    7.53185244e+01, 6.88318008e+01, 3.61667698e+01, -7.57925065e+00,
    -4.56615536e+01, -6.66670313e+01, -6.43612264e+01, -3.85945391e+01,
    6.16783518e-01, 3.57407648e+01, 5.33849028e+01, 5.12016043e+01,
    3.29995552e+01, 3.86621066e+00, -2.74924671e+01, -4.89241490e+01,
    -5.24712265e+01, -3.86299866e+01, -1.25080152e+01, 1.84611494e+01,
    4.27640638e+01, 4.85912314e+01, 3.33179020e+01, 6.10011848e+00,
    -2.00911922e+01, -3.69132378e+01, -4.19154042e+01, -3.51603823e+01,
    -1.72613266e+01, 8.35918608e+00, 3.19571949e+01, 4.05603784e+01,
    2.90633601e+01, 6.33776195e+00, -1.37856697e+01, -2.52158677e+01,
    -2.93517998e+01, -2.67140622e+01, -1.60424606e+01, 4.30873152e-02,
    1.48558734e+01, 2.31810198e+01, 2.35309701e+01, 1.59763055e+01,
    1.64969483e+00, -1.48809436e+01, -2.59379206e+01, -2.63462895e+01,
    -1.79178921e+01, -6.13945887e+00, 5.99299984e+00, 1.72573581e+01,
    2.31897756e+01, 1.80700201e+01, 3.00336870e+00, -1.28844368e+01,
    -2.08991034e+01, -1.94664037e+01, -1.25256404e+01, -4.98553147e+00
]

# 2) Normalize
max_val = max(data)              # maximum of the list
normalized = [x / max_val for x in data]

# FFT and frequency bins
fs = 1/3000
X = np.fft.fft(normalized)
freqs = np.fft.fftfreq(len(normalized), d=1/fs)

# Keep only positive frequencies
pos_mask = freqs > 0
freqs_pos = freqs[pos_mask]*1E7
X_pos = X[pos_mask]
mag_pos = np.abs(X_pos)  # magnitude spectrum

# 3) Reduced impulse response
reduced = [0.0, 0.0, 0.0, 0.25, 0.25, -0.25, -0.5, 0.25, 1.0, 0.25, -1.0, -1.0, 0.0, 1.0, 0.5, 0.0,
 -0.5, -0.5, -0.25, 0.0, 0.25, 0.5, 0.25, 0.0, -0.25, -0.25, -0.25, 0.0, 0.25, 0.25, 0.25,
 0.25, 0.0, -0.25, -0.25, -0.25, 0.0, 0.0, 0.25, 0.25, 0.0, 0.0, 0.0, -0.25, -0.25, 0.0,
 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,
 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,
 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,
 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,
 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0]

Y = np.fft.fft(reduced)
Y_pos = Y[pos_mask]
reduced_mag_pos = np.abs(Y_pos)

# 3) Plot the normalized values
fig, axes = plt.subplots(2, 1, figsize=(10, 7))
axes[0].plot(normalized, color='blue', linewidth=1.5, label='Full')
axes[0].plot(reduced, color='red', linewidth=1.5, linestyle='dashed', label='Reduced')
axes[0].set_title('Full and reduced impulse response and frequency spectrum')
axes[0].set_xlabel('Time (3 GSa/s samples)')
axes[0].set_ylabel('Voltage (arb. units)')
axes[0].grid(True, linestyle='--', alpha=0.5)
axes[0].legend(loc="upper right")
axes[1].plot(freqs_pos, mag_pos, color='blue', linewidth=1.5, label='Full')
axes[1].plot(freqs_pos, reduced_mag_pos, color='red', linewidth=1.5, linestyle='dashed', label='Reduced')
axes[1].set_xlabel('Frequency (MHz)')
axes[1].set_ylabel('Power spectral density (arb. units)')
plt.tight_layout()
plt.show()
fig.savefig('impulse_resp.png', bbox_inches='tight')
